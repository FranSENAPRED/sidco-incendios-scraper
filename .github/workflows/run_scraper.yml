name: Ejecutar SIDCO Scraper cada 1 minuto

on:
  schedule:
    - cron: "* * * * *"    # corre cada 1 minuto
  workflow_dispatch:        # permite ejecutarlo manualmente

jobs:
  run-scraper:
    runs-on: ubuntu-latest

    steps:
    - name: Clonar repositorio
      uses: actions/checkout@v3

    - name: Instalar Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.10"

    - name: Instalar dependencias
      run: |
        pip install -r requirements.txt
        pip install playwright
        playwright install chromium

    - name: Exportar variables de entorno
      env:
        SIDCO_USER: ${{ secrets.SIDCO_USER }}
        SIDCO_PASS: ${{ secrets.SIDCO_PASS }}
      run: |
        echo "SIDCO_USER=$SIDCO_USER" >> $GITHUB_ENV
        echo "SIDCO_PASS=$SIDCO_PASS" >> $GITHUB_ENV

    - name: Ejecutar scraper
      run: python sidco_scraper.py

    - name: Subir archivo CSV como artefacto
      uses: actions/upload-artifact@v3
      with:
        name: incendios_vigentes_sidco
        path: incendios_vigentes_sidco_enriquecido.csv

    - name: Commit del CSV actualizado (opcional)
      run: |
        git config --global user.name "GitHub Actions"
        git config --global user.email "actions@github.com"
        git add *.csv
        git commit -m "Actualizaci√≥n scraper SIDCO" || echo "No hay cambios"
        git push
